---
title: 猫でも分かるgitrebaseの使い方
date: 2017-02-22 13:09:44
tags: git
---
どうも、せっきーです。  
  
gitを使い始めてからはや4年。  
よく使われる一通りのgitコマンドは使いこなせる様になったかと思いきや、git rebaseはずっと苦手で、ずっとなあなあにして来ました。
<br />
<br />
git rebaseは言ってしまえばgitのコミットログをキレイにする為のコマンドなのですが、イマイチその有用性を実感できず、最近までひとつのプルリクにいくつもログが残ったままpushしておりました。  

しかしこのままではいかんと思い、このたびgit rebaseをマスターすべく勉強してみました。  
<br />
<br />
git rebaseを理解しようとして挫折する人の一番の壁は、コンフリクトした際に「no branch」に飛ばされてしまう現象じゃないかと個人的には思います。  
<br />
実際にターミナルの画面を見ながら解説します。  
まずは普通の成功例。  
  
こんなログのブランチがあったとします。 

<img src="https://i.gyazo.com/dcc293fa3520a8562e0980a5aacaf913.png">  
<br />
<br />
例えば修正Bと修正Cのログをひとつにまとめたいと思った場合のコマンドは、  
```
git rebase -i HEAD~2
```
 

になります。  
実際に打ってみます。  
  
<img src="https://i.gyazo.com/5761bac75ac98865d7972d6c9cb51a80.png">  

するとこんな画面になりますので、  
ベースとなるコミットにpick、他とまとめたいコミットにsquashを入力し、
<img src="https://i.gyazo.com/8df69d0084dde84a005bb8e204d37aca.png">  

:wqで保存します。すると、  
<img src="https://i.gyazo.com/a3150837a78b86720fe7ee9f60bfbed0.png">  
コミットメッセージ編集画面になりますので、１行にまとめて、

<img src="https://i.gyazo.com/f5a992fbca73171ba3153375fbd1002c.png">  

同様に:wqで保存します。  
すると、  
<img src="https://i.gyazo.com/8a9db960b8a063543e34261c629a369a.png">  

こんな感じでひとつのコミットにまとめられました。  

しかしたまにこんな感じのエラーが出て…  
<img src="https://i.gyazo.com/f0f9168965010eee93ae592f2e4ff7e3.png">  

この様に(no branch)と言う謎のブランチに飛ばされる事があります。  
<img src="https://i.gyazo.com/ee18617b98441a911f79c4d386cc0871.png">  

これはrebaseする事によりコンフリクトが起こる為、自動的にマージ出来ない場合に起きます。  

そうなった場合は冷静にコンフリクトしているファイルを確認し、  
```
git add
```
  

して、  
```
git rebase --continue
```


すればOKです。
ただ、その時点ではまだno branchにいるので、  
マージした内容を、元いたブランチにpushする必要があるのですが、普通に  
```
git push origin (hoge)
```
  
と打ってもエラーになりますので、-fコマンドを使いましょう。  
  
これはエラーがあっても強制的にpushするコマンドなので、自分以外が触っている可能性があるブランチでは使わない様に。  
  
以上がgit rebaseのやり方とつまづきドコロでした。  

普段からブランチはこまめに分ける大切さを実感出来ましたね。